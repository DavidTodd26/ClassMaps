{% extends 'classes/layout.html' %}
{% load static %}

{% block content %}

<html>
<link rel="stylesheet" type="text/css" href="{% static 'classes/style.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'classes/assets/css/bootstrap.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'classes/assets/css/github.css' %}">
<link rel="stylesheet" type="text/css" href="{% static 'classes/dist/bootstrap-clockpicker.css' %}">

<!-- Add icon library -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">

<script src="https://unpkg.com/leaflet@1.3.1/dist/leaflet.js" integrity="sha512-/Nsx9X4HebavoBvEBuyp3I7od5tA0UzAxs+j83KgC8PU0kgB4XiK4Lfe4y4cgBtaRJQEIFCW+oC506aPT2L1zw==" crossorigin=""></script>

<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.css">
<script src="https://cdn.jsdelivr.net/npm/leaflet-easybutton@2/src/easy-button.js"></script>

  <script type="text/javascript" src="{% static 'classes/buildings.js' %}"></script>
  <script type="text/javascript" src="{% static 'classes/printers.js' %}"></script>
  <script type="text/javascript" src="{% static 'classes/laundry.js' %}"></script>
  <script type="text/javascript" src="{% static 'classes/hotspots.js' %}"></script>
  <script type="text/javascript" src="{% static 'classes/water.js' %}"></script>

  <script type="text/javascript" src="{% static 'classes/assets/js/jquery.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'classes/assets/js/bootstrap.min.js' %}"></script>
  <script type="text/javascript" src="{% static 'classes/dist/bootstrap-clockpicker.js' %}"></script>

  <link rel="stylesheet" href="https://code.jquery.com/ui/1.8.18/themes/base/jquery-ui.css" type="text/css">
  <script src="https://ajax.googleapis.com/ajax/libs/jqueryui/1.9.1/jquery-ui.min.js" type="text/javascript"></script>


<head bgcolor="#000000">
  <!-- Global site tag (gtag.js) - Google Analytics -->
<script async src="https://www.googletagmanager.com/gtag/js?id=UA-118677193-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-118677193-1');
</script>

  <title>ClassMaps</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.3.1/dist/leaflet.css" integrity="sha512-Rksm5RenBEKSKFjgI3a41vrjkw4EVPlJ3+OiI65vTjIdo9brlAacEuKOiQ5OFh7cOI1bkDwLqdLw3Zg0cRJAAQ==" crossorigin=""/>

  <style>
      html, body {
       height: 100%;
      }
      #map {
          height: 100%;
          width: 100%;
          float: left;
          z-index: 1;
          position: relative;
      }
    ::-webkit-scrollbar {
        display: none;
    }
    .slidecontainer {
        margin: 0 auto;
        width: 350px;
    }
    .btn-remove {background-color: #f44336;} /* red */
    .export {
      padding: 5px
    }
    .overlay {
      height: auto;
      width: 100%;
      min-height: 75px;
      max-height: 85px;
      margin-left: -100%;
      position: relative;
      float: right;
      z-index: 10;
      padding-top: 1%;
      padding-bottom: 0.5%;
      padding-right: 40px;
      padding-left: 10px;
      background-color:rgba(0,0,0,0.6); // Sets to 50% transparent;
      pointer-events: auto;
    }
    .dropdown-menu{
      background-color:	#f9f9f9;
      padding-left: 10px;
      width: 80px;
    }
    /* Show the dropdown menu on hover */
    .dropdown:hover .dropdown-content {
        display: block;
    }
    /* Change the background color of the dropdown button when the dropdown content is shown */
    .dropdown:hover .dropbtn {
        background-color: #3e8e41;
    }
    ::placeholder {
      color: #d3d3d3;
      opacity: 1; /* Firefox */
    }
    :-ms-input-placeholder { /* Internet Explorer 10-11 */
       color: #d3d3d3;
    }
    ::-ms-input-placeholder { /* Microsoft Edge */
       color: #d3d3d3;
    }
    input, select, textarea {
      color: white;
    }
    textarea:focus, input:focus {
        color: white;
    }
    .astext {
      background:none;
      border:none;
      color: orange;
    }
    .fa{
      padding-right: 5px;
      padding-left: 5px;
    }
    /* Start help overlay css */
    .helpOverlay {
      position: fixed;
      display: none;
      width: 100%;
      height: 100%;
      top: 0;
      left: 1;
      right: 0;
      bottom: 0;
      background-color: rgba(211,211,211,0.4);
      z-index: 3;
      cursor: pointer;
      transition: 0.5s;
      padding: 20%;
    }
    /* Start sidebar css */
    .sideOverlay {
      position: fixed;
      display: none;
      width: 0;
      height: 100%;
      top: 0;
      left: 1;
      right: 0;
      bottom: 0;
      background-color: #d3d3d3;
      background: linear-gradient(to top, rgba(211,211,211,0.85), rgba(211,211,211,1));
      z-index: 3;
      cursor: pointer;
      transition: 0.5s;
      padding-top: 60px;
    }
    .sideOverlay a {
      padding: 6px 6px 6px 30px;
      text-decoration: none;
      font-size: 17px;
      color: #282828;
      display: block;
      transition: 0.5s;
    }
    .sideOverlay a:hover {
        color: #f1f1f1;
    }
    .sideOverlay .closebtn {
        position: absolute;
        top: 0;
        right: 15px;
        font-size: 34px;
        margin-left: 50px;
    }
    /* Start saved list css */
    .listOverlay {
      margin: 10px;
      border-radius: 4px;
      position: fixed;
      display: none;
      width: 300px;
      height: 50%;
      top: 1;
      left: 0;
      right: 0;
      bottom: 0;
      background-color: rgba(0,0,0,0.6);
      z-index: 3;
      cursor: pointer;
    }
    .listText {
      color: white;
    }
    .listTitle {
      color: white;
      font-size: large;
      text-align: left;
    }
    /* End saved list css */
    .slider {
      padding-left: 20px;
    }
    .ui-autocomplete {
      width: auto;
      height: auto;
      max-height: 40%;
      max-width: 40%;
      overflow-y: auto;
      font-size: small;
    }
    /* Search result overlay */
    .resultsContainer {
      padding-top: 85px;
    }
    .resultsOverlay {
      height: auto;
      width: 100%;
      margin-left: -100%;
      position: relative;
      float: right;
      z-index: 2;
      padding-top: 1%;
      padding-bottom: 0.5%;
      background-color:rgba(0,0,0,0.6); // Sets to 50% transparent;
      pointer-events: auto;
    }
    /* Horizontal Scroll */
    .match-group > .row {
      overflow-x: auto;
      white-space: nowrap;
      padding-left: 0.5%;
      padding-right: 0.5%;
    }
    .match-group > .row > .col-xs-4 {
      display: inline-block;
      float: none;
    }
    .col-xs-4 {
      width: 200px;
      color: black;
      font-size: small;
      background: white;
    }
  </style>
</head>

<!-- Autocomplete js -->
<script>
$(function() {
  $("#search").autocomplete({
    minLength: 3,
    source: function(request, response) {
      $.ajax({
        url: "/api/query/",
        dataType: "json",
        data: {
          q: request.term,
          t: $('#clock').val(),
          M: convertBool($('#M').is(":checked")),
          T: convertBool($('#T').is(":checked")),
          W: convertBool($('#W').is(":checked")),
          Th: convertBool($('#Th').is(":checked")),
          F: convertBool($('#F').is(":checked")),
        },
        success: function(data) {
          response(data);
        }
      });
    },
    select: function(event, ui) {
      if (ui.item) {
        $(event.target).val(ui.item.value);
      }
      $(event.target.form).submit();
    }
  });
});

// Convert to match main query format
function convertBool(b) {
  if (b) {
    return b;
  }
  return null;
}
</script>

  <div id="map"></div>

<!-- Overlay div begins -->
  <div id="overlay" class="overlay">
    <form id="searchbar" name="myform" method="GET" action="{% url 'classes:search' %}">
     <a href="https://classmaps.herokuapp.com">
     <img src="{% static 'classes/images/lightlogo.png'%}" alt="ClassMaps" style="width:52px; float:left; margin-right:10px">
     </a>

    <div style="width:32%; float:left;">
        <input id = "search" name = "q" value="{{request.GET.q}}" placeholder="Enter a course or building...">
    </div>
    <div style="width:10px; float:left;">
      <input style="color: white;" placeholder="" readonly>
   </div>
    <div style="width:74px; float:left;">
      <div class="input-group clockpicker pull-center" data-placement="bottom" data-align="top" data-autoclose="false">
        <input id="clock" type="text" class="form-control" name="t" placeholder="Set Time," style="color: white; cursor: pointer;" onfocus="this.blur()" readonly>
      </div>
    </div>

   <div style="float:left; width:50px;">
    <div class="dropdown" style="float:left; ">
<!--       <button class="btn btn-secondary dropdown-toggle" type="button" id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
        <img src="{% static 'classes/images/weekicon.png'%}" alt="Day of Week" style="width:20px;">
      </button> -->
      <input id="dropdownMenuButton" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" type="text" class="form-control" name="t" placeholder="Date" style="color: white; cursor: pointer;" readonly>
    <div id="dropdown-menu" class="dropdown-menu" aria-labelledby="dropdownMenuButton">
        <label class="switch">
          <input id = "M" name = "M" value = "M" type="checkbox">
          <span class="slider"> Monday </span>
        </label><br>
        <label class="switch">
          <input id = "T" name = "T" value = "T" type="checkbox">
          <span class="slider"> Tuesday </span>
        </label><br>
        <label class="switch">
          <input id = "W" name = "W" value = "W" type="checkbox">
          <span class="slider"> Wednesday </span>
        </label><br>
        <label class="switch">
          <input id = "Th" name = "Th" value = "Th" type="checkbox">
          <span class="slider"> Thursday </span>
        </label><br>
        <label class="switch">
          <input id = "F" name = "F" value = "F" type="checkbox">
          <span class="slider"> Friday </span>
        </label>
        </div>
      </div>
    </div>

   <div style="width:25px; float:left; padding-right: 10px;" onclick="clearForm()">
    <input type="text" style="color: white; cursor: pointer;" placeholder="&times;" readonly>
   </div>

    <div style="float:left; padding-right: 10px;">
      <button class="btn btn-success" type="submit" style="display:none">
        <i class="fa fa-search"></i>Search ClassMaps
      </button>
    </div>
  </form>


  <div style="float: right; padding-right: 10px; position: fixed; top: 10px; right: 0;">
    <span style="font-size:25px;cursor:pointer; color: white; padding-bottom: 7px;" onclick="openNav()">&#9776;</span>
      </div>
  </div>
 </div>

 <!-- overlay div ends -->

 <div id="listOverlay" class="listOverlay" style="overflow: auto;">
   <table id="myTable" class="table order-list">
   <thead>
       <tr>
           <td><div class="listTitle"><i class="fa fa-star"></i>Favorites</div></td>
       </tr>
   </thead>
   <tfoot>
       <tr>
           <td colspan="5" style="text-align: left;">
<!--                <input type="button" class="btn btn-lg btn-block" id="export" value="Export to Calendar" /> -->
           </td>
       </tr>
       <tr>
       </tr>
   </tfoot>
</table>
</div>

<!--  Code search result overlay -->
<div id="resultsContainer" class="resultsContainer" style="display: none;">
  <div id="resultsOverlay" class="resultsOverlay" style="overflow: auto;">
    <div class="container match-group">
      <div id="buildings" class="row text-center">

      </div>
    </div>

    <div class="container match-group">
      <div id="courses" class="row text-center">

      </div>
    </div>
  </div>
</div>

<!-- Script for matches -->
<script>
function truncate(line) {
  var maxLength = 30;
  if (line.length <= maxLength) {
    return line;
  }
  return $.trim(line.substring(0, maxLength))+"...";
}

function addCourseRow(id, text) {
  $("#"+id).append("<div class=\"col-xs-4\">"+text+"</div>");
}

{% if buildings or classes %}
  var matchesBlock = document.getElementById("resultsContainer");
  matchesBlock.style.display = "block";
{% endif %}

{% if buildings %}
    {% for b in buildings %}
      if ("{{b.names|last}}") {
        addCourseRow("buildings", "<a href=\"/buildings/{{b}}\" style=\"color: white;\">{{b}}<br>{{b.names|last}}");
      } else {
        addCourseRow("buildings", "<a href=\"/buildings/{{b}}\" style=\"color: white;\">{{b}} {{b.names|last}}");
      }
    {% endfor %}
{% endif %}

{% if classes %}
    {% for c in classes %}
      var formatted = truncate("{{c}} {{c.section}}")+"<br>"+truncate("{{c.title}}");
      addCourseRow("courses", "<a href=\"/courses/{{c.pk}}\" style=\"color: white;\">"+formatted);
    {% endfor %}
{% endif %}

//addCourseRow("4");
</script>

<!--  Code for sidebar overlay  -->
   <div id="sideOverlay" class="sideOverlay" style="overflow: auto;">
    <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
    <a style="pointer-events: none;"> Welcome, {{netid}}</a>
    <a href="https://andsylin.github.io/" target="_blank">About</a>
    <a onclick="openHelp()">Help</a>
    <a href="https://docs.google.com/forms/d/e/1FAIpQLSfOX9jOp3gI_k9EWZPRFgFlG76HYGUtcY1nLl1pCTybvus0nQ/viewform?usp=sf_link" target="_blank">Feedback</a>
    <a href="https://andsylin.github.io/members/" target="_blank">Contact</a>
    <a href="https://classmaps.herokuapp.com/accounts/logout">Sign Out</a>

      <footer style="font-size: 12px; padding: 10px; position: absolute; bottom: 0; right: 0;">
        <p>To add the site to your phone's homescreen, open the <a style="padding: 0; font-size: 12px; color: blue;" href="/">homepage</a></p>
        <p>On iPhone, click the <img height="24" src="{% static 'classes/images/action.png' %}"> button on the bottom of Safari</p>
        <p>On Android, click on the <img src="{% static 'classes/images/3dot.png' %}"/> button on the top right of Chrome</p>
        <p>Click "Add to Home Screen" <img src="{% static 'classes/images/icons/24x24.png' %}"/></p>
      </footer>
  </div>

<!--  Code for help overlay  -->
   <div id="helpOverlay" class="helpOverlay" style="overflow: auto;" onclick="closeHelp()">
     <h3>Help</h3>
     <a href="javascript:void(0)" class="closebtn" onclick="closeHelp()">&times;CLOSE</a>
     This is the help overlay. (This part has yet to be completed, sorry.)
   </div>
<!-- sidenav script  -->
<script>

  /* When the user clicks on the button,
toggle between hiding and showing the dropdown content */
  function clearForm() {
    console.log("cleared form");
    document.getElementById("searchbar").reset();
  }
  function openHelp() {
      document.getElementById("helpOverlay").style.display = "block";
     document.getElementById("sideOverlay").style.width = "0";
      document.getElementById("sideOverlay").style.display = "none";
  }
  function closeHelp() {
      document.getElementById("helpOverlay").style.display = "none";
  }
  function openNav() {
      document.getElementById("sideOverlay").style.display = "block";
      document.getElementById("sideOverlay").style.width = "190px";
  }
  function closeNav() {
      document.getElementById("sideOverlay").style.width = "0";
      document.getElementById("sideOverlay").style.display = "none";
  }

  //  script for saved list
  var collapse = true;
  var width = (window.innerWidth > 0) ? window.innerWidth : screen.width;
  console.log(width);
  if(width > 720){
   var x = document.getElementById("listOverlay");
   x.style.display = "block";
    collapse = false;
  }

  $('.dropdown-menu').on('click', function(e) {
    e.stopPropagation();
  });

  function addRow(name, button) {
      var newRow = $("<tr>");
      var cols = "";

      cols += '<td><div class="listText" name="name">'+name+'</div></td>';
      cols += '<td>'+button+'</td>';
      newRow.append(cols);
      $("table.order-list").append(newRow);
  }

  $("table.order-list").on("click", ".ibtnDel", function (event) {
      $(this).closest("tr").remove();
  });

   $('.clockpicker').clockpicker({
     twelvehour: true,
     default: 'now'
   })
   .find('input').change(function(){
     console.log(this.value);
   });
   var input = $('#single-input').clockpicker({
     placement: 'bottom',
     align: 'left',
     autoclose: true,
     default: 'now'
   });

    // Adds different layer groups
    var printers = L.layerGroup();
    var hotspots = L.layerGroup();
    var waterspots = L.layerGroup();
    var laundry = L.layerGroup();
    var buildings = L.layerGroup();

     var printerIcon = L.icon({
       iconUrl: "{% static 'classes/images/printer.png' %}",
       iconSize:     [28, 28], // size of the icon
       iconAnchor:   [14, 14], // point of the icon which will correspond to marker's location
       popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
     });
     var laundryIcon = L.icon({
       iconUrl: "{% static 'classes/images/washing-machine.png' %}",
       iconSize:     [28, 28], // size of the icon
       iconAnchor:   [14, 14], // point of the icon which will correspond to marker's location
       popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
     });
     var hotspotIcon = L.icon({
       iconUrl: "{% static 'classes/images/hotspot.png' %}",
       iconSize:     [26, 26], // size of the icon
       iconAnchor:   [13, 13], // point of the icon which will correspond to marker's location
       popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
     });
     var waterIcon = L.icon({
       iconUrl: "{% static 'classes/images/watericon.png' %}",
       iconSize:     [26, 26], // size of the icon
       iconAnchor:   [13, 13], // point of the icon which will correspond to marker's location
       popupAnchor:  [0, 0] // point from which the popup should open relative to the iconAnchor
     });
     var savedIcon = L.icon({
       iconUrl: "{% static 'classes/images/marker-icon-green.png' %}",
       iconAnchor:   [12, 41], // point of the icon which will correspond to marker's location
       popupAnchor:  [0, -35] // point from which the popup should open relative to the iconAnchor
     });
     var myIcon = L.icon({
       iconUrl: "{% static 'classes/images/youarehere.png' %}",
       iconSize:     [35, 35], // size of the icon
       iconAnchor:   [18, 18], // point of the icon which will correspond to marker's location
       popupAnchor:  [0, -18] // point from which the popup should open relative to the iconAnchor
     });
    for (var i = 0; i < printerLocs.length; i++) {
  //if (hi[i][3] == '6' || hi[i][3] == '29')
    if (printerLocs[i][3] == '6') L.marker([printerLocs[i][0], printerLocs[i][1]], {icon: printerIcon}).bindPopup(printerLocs[i][2]).addTo(printers);
    if (printerLocs[i][3] == '29') L.marker([printerLocs[i][0], printerLocs[i][1]], {icon: printerIcon}).bindPopup(printerLocs[i][2]).addTo(printers);
    if (printerLocs[i][3] == '28') L.marker([printerLocs[i][0], printerLocs[i][1]], {icon: printerIcon}).bindPopup(printerLocs[i][2]).addTo(printers);
 }
 for (var i = 0; i < laundryLocs.length; i++) {
  //if (hi[i][3] == '6' || hi[i][3] == '29')
    L.marker([laundryLocs[i][0], laundryLocs[i][1]], {title: laundryLocs[i][2], icon: laundryIcon}).bindPopup(laundryLocs[i][2]).addTo(laundry);
 }
 for (var i = 0; i < hotspotLocs.length; i++) {
  //if (hi[i][3] == '6' || hi[i][3] == '29')
    L.marker([hotspotLocs[i][0], hotspotLocs[i][1]], {title: hotspotLocs[i][2], icon: hotspotIcon}).bindPopup(hotspotLocs[i][2]).addTo(hotspots);
 }

 for (var i = 0; i < waterLocs.length; i++) {
  //if (hi[i][3] == '6' || hi[i][3] == '29')
    L.marker(waterLocs[i][0], {title: waterLocs[i][1], icon: waterIcon}).bindPopup(waterLocs[i][1]).addTo(waterspots);
 }
    // URLS of maps for different layers (note: need to add attributes)
    var mbAttr = 'Map data &copy; <a href="https://openstreetmap.org">OpenStreetMap</a> contributors, ' +
      '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
      'Imagery Â© <a href="https://mapbox.com">Mapbox</a>',
    mbUrl = 'https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png',
    mbUrl2 = 'https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}';
    // Different layers
    var regular   = L.tileLayer(mbUrl, {id: 'mapbox.light', attribution: mbAttr}),
    satellite  = L.tileLayer(mbUrl2, {id: 'mapbox.satellite',   attribution: mbAttr});
    // Initializes the map
    var map = L.map('map', {
      center: [40.346825, -74.656595],
      zoom: 16,
      layers: [regular, buildings],
      zoomControl: true
    });
    /*$('.pure-button').on('click', function(){
mymap.locate({setView: true, maxZoom: 15});
});*/


    // Bookmarks
    //var control = new L.Control.Bookmarks().addTo(map);
    // Our different layers
    var baseLayers = {
      "Regular": regular,
      "Satellite": satellite
    };
    // Our overlays
    var overlays = {
      "Printers": printers,
      "Laundry": laundry,
      "Hotspots": hotspots,
      "Filtered Water": waterspots,
      "Buildings": buildings
    };
    // Adds overlays and layers to map
    L.control.layers(baseLayers, overlays, {position: 'bottomright', collapsed: collapse}).addTo(map);
    map.zoomControl.setPosition('bottomright');


L.easyButton('<img src="{% static 'classes/images/currentloc.png' %}" style="width:16px">', function (btn, map) {

    map.locate({
        setView: true,
        maxZoom: 18
    });

    //map.locate({setView: true,watch: true, maxZoom: 16});
    function onLocationFound(e) {
    var radius = e.accuracy / 2;
    L.marker(e.latlng, {icon: myIcon}).addTo(map)
        .bindPopup("You are within " + Math.round(radius) + " meters from this point").openPopup();
    L.circle(e.latlng, radius).addTo(map);
    }
    map.on('locationfound', onLocationFound);
}).setPosition('bottomright').addTo(map);

L.easyButton('<img src="{% static 'classes/images/refresh.png' %}" style="width:16px">', function(btn, map){
    map.setView(new L.LatLng(40.346825, -74.656595), 16);
//map.setView(        [40.347, -74.653],      zoom: 16);
}).setPosition('bottomright').addTo(map);

L.easyButton('<img src="{% static 'classes/images/star.png' %}" style="width:16px">', function(btn, map){
    var x = document.getElementById("listOverlay");
    if (x.style.display === "none") {
        x.style.display = "block";
    } else {
        x.style.display = "none";
    }
}).setPosition('bottomright').addTo(map);
    // Limits zoom (we could get rid of this)
    map.options.minZoom = 14;
    map.options.maxZoom = 18;
    function getColor(d) {
  if (d == 'dormitory') return '#800026';
  else if (d == 'university') return '#FEB42C';
  else return '#FED976';
  /*return d > 1000 ? '#800026' :
      d > 500  ? '#BD0026' :
      d > 200  ? '#E31A1C' :
      d > 100  ? '#FC4E2A' :
      d > 50   ? '#FD8D3C' :
      d > 20   ? '#FEB24C' :
      d > 10   ? '#FED976' :
            '#FFEDA0';*/
}
    function style(feature) {
  return {
    weight: 2,
    opacity: 1,
    color: 'white',
    dashArray: '3',
    fillOpacity: 0.7,
    fillColor: getColor(feature.properties.building)
    //fillColor: '#FED976'
  };
}
      function highlightFeature(e) {
  var layer = e.target;
  layer.setStyle({
    weight: 5,
    color: '#666',
    dashArray: '',
    fillOpacity: 0.7
  });
  //if (!L.Browser.ie && !L.Browser.opera && !L.Browser.edge) {
  //  layer.bringToFront();
  //}
  //info.update(layer.feature.properties);
}
function onEachFeature(feature, layer) {
  var buildquery = feature.properties.name
  var buildingtext = buildquery +
         "<form method=\"GET\" action=\"{% url 'classes:search' %}\">" +"<br>"+
         "<button class=\"btn btn-success\" name=\"q\" value=\""+buildquery+"\" type=\"submit\">" +
             "<i class=\"fa fa-search\">"+"</i>"+"Classes Here" +
         "</button>" +
     "</form>";
  layer.bindPopup(buildingtext);
  layer.on({
    mouseover: highlightFeature,//,
    mouseout: resetHighlight,
    click: zoomToFeature
  });
}
function zoomToFeature(e) {
  map.fitBounds(e.target.getBounds());
  e.bindPopup("You are within meters from this point");//.openPopup();
}
function resetHighlight(e) {
  geojson.resetStyle(e.target);
  //info.update();
}
    var geojson;
  geojson = L.geoJson(buildingData, {style: style, onEachFeature: onEachFeature}).addTo(buildings);
 /* var legend = L.control({position: 'bottomright'});
legend.onAdd = function (buildings) {
  var div = L.DomUtil.create('div', 'info legend'),
    grades = ['dormitory', 'university', 'other'],
    labels = [],
    from, to;
  for (var i = 0; i < grades.length; i++) {
    from = grades[i];
    //to = grades[i + 1];
    labels.push(
      '<i style="background:' + getColor(from) + '"></i> ' +
      from + (from ? '&ndash;' + from : '+'));
  }
  div.innerHTML = labels.join('<br>');
  return div;
};
<<<<<<< HEAD
//legend.addTo(buildings);
    // Displays current user location and accuracy
    /*function onLocationFound(e) {
      var radius = e.accuracy / 2;
      L.marker(e.latlng).addTo(map).bindPopup("You are within " + radius + " meters from this point").openPopup();
      L.circle(e.latlng, radius).addTo(map);
    }
    map.on('locationfound', onLocationFound);*/
//     // Displays coordinates upon mouse click
//     var popup = L.popup();
//     function onMapClick(e) {
//       popup
//         .setLatLng(e.latlng)
//         .setContent("You clicked the map at " + e.latlng.toString())
//         .openOn(map);
//     }
//     map.on('click', onMapClick);

//legend.addTo(buildings);
/*
function addRow() {
    var newRow = $("<tr>");
    var cols = "";

    cols += '<td><input type="text" class="form-control" name="name"/></td>';
    cols += '<td><input type="text" class="form-control" name="mail"/></td>';
    cols += '<td><input type="text" class="form-control" name="phone"/></td>';

    cols += '<td><input type="button" class="ibtnDel btn btn-md btn-danger "  value="Delete"></td>';
    newRow.append(cols);
    $("table.order-list").append(newRow);
}
*/
lonlats = {};
var offset = 0.0001;
{% if saved_buildings %}
   {% for s in saved_buildings %}
     var key = "{{s.lon}} {{s.lat}}"
     var button =
     "<form method=\"GET\" action=\"{% url 'classes:index' %}\">" +"<br>"+
         "<button class=\"btn btn-remove\" name=\"r\" value=\"{{s.pk}}b\" type=\"submit\">" +
             "<i class=\"fa fa-close\">"+"</i>"+"Remove" +
         "</button>" +
     "</form>";
     var text = "<div>{{s}}</div>"+button;
     if (key in lonlats) {
       lonlats[key] += "<br>"+text;
     } else {
       lonlats[key] = text;
     }
     addRow("{{s.names.0}}", button);
  {% endfor %}
{% endif %}
{% if saved_courses %}
   {% for s in saved_courses %}
     var key = "{{s.building_lon}} {{s.building_lat}}";
     var button =
     "<form method=\"GET\" action=\"{% url 'classes:index' %}\">" +"<br>"+
         "<button class=\"btn btn-remove\" name=\"r\" value=\"{{s.pk}}c\" type=\"submit\">" +
             "<i class=\"fa fa-close\">"+"</i>"+"Remove" +
         "</button>" +
     "</form>";
     var text = "<div>{{s}}</div>"+button;
     if (key in lonlats) {
       lonlats[key] += "<br>"+text;
     } else {
       lonlats[key] = text;
     }

     addRow("<div>{{s}}</div><div>{{s.building}}</div><div>{{s.time}}</div>", button);
    {% endfor %}
{% endif %}
if (!jQuery.isEmptyObject(lonlats)) {
  var count = 0;
  for (var key in lonlats) {
    var tokens = key.split(" ");
    var lon = parseFloat(tokens[0])-offset;
    var lat = tokens[1];
    if (lon) {
        L.marker([lat, lon], {icon: savedIcon}).addTo(map).bindPopup(lonlats[key]);
    }
  }
  {% if last_lon %}
    {% if last_lat %}
      {% if zoom %}
        lon = "{{last_lon}}"
        lat = "{{last_lat}}"
        map.setView([lat, parseFloat(lon)+offset],17);
      {% endif %}
    {% endif %}
  {% endif %}
}

    // Searched marker
    {% if building %}
        var lon = "{{building.lon}}";
        var lat = "{{building.lat}}";
        var id = "{{building.pk}}";
        var type = "b";
        var name = "{{building}}";
    {% elif c %}
        var lon = "{{c.building_lon}}";
        var lat = "{{c.building_lat}}";
        var id = "{{c.pk}}";
        var type = "c";
        // modified this line to add parameters

        var name = "{{c}} {{c.title}} {{c.section}} {{c.building}} {{c.room}} {{c.day}} {{c.time}}";
       if (!lon && !lat) {
          lon = -74.656509;
          lat = 40.346699;
          var name = "<div>NO BUILDING<\div><div>{{c}} {{c.day}} {{c.starttime}}-{{c.endtime}}</div>";
        }
    {% endif %}
    {% if building or c %}
      var search = "<div>" + name + "</div>" +
      "<form method=\"GET\" action=\"{% url 'classes:index' %}\">" +"<br>"+
          "<button id=\"addrow\" class=\"btn btn-success\" name=\"s\" value=\""+id+type+"\" type=\"submit\">" +
              "<i class=\"fa fa-star\">"+"</i>"+"Favorite" +
          "</button>" +
      "</form>";
       L.marker([lat, parseFloat(lon)+offset]).addTo(map).bindPopup(search).openPopup();
       map.setView([lat, parseFloat(lon)+offset],17);
    {% endif %}
  </script>

</body>
</html>

{% endblock %}
